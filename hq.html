<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ü¶û Agent Arena HQ ‚Äî Your AI Office</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@400;500;600;700;800&display=swap');
  :root {
    --bg: #1e1b2e; --floor: #2a2540; --wall: #3d3355;
    --desk: #5c3d1e; --desk-top: #8b6842;
    --text: #ececf1; --muted: #8e8ea0; --accent: #fbbf24;
    --green: #22c55e; --blue: #3b82f6; --red: #ef4444;
    --purple: #a855f7; --pink: #ec4899; --cyan: #06b6d4;
    --surface: #1a1726; --border: #352f48;
    --warm-glow: rgba(251, 191, 36, 0.06);
    --wood: #8b6842; --wood-dark: #5c3d1e; --wood-light: #a67c52;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Inter', sans-serif; background: #12101e; color: var(--text); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
  .main-content { display: flex; flex: 1; overflow: hidden; }

  /* Left: Office View */
  .office-wrap { flex: 1; display: flex; flex-direction: column; }
  .office-topbar {
    padding: 12px 20px; background: var(--surface); border-bottom: 1px solid var(--border);
    display: flex; align-items: center; justify-content: space-between; gap: 12px;
    background: linear-gradient(90deg, var(--surface), #1e1a2e);
  }
  .office-topbar h1 { font-family: 'Press Start 2P', monospace; font-size: 12px; color: var(--accent); white-space: nowrap; }
  .office-topbar .squad-count { font-size: 12px; color: var(--muted); white-space: nowrap; }
  .office-topbar .gw-status { font-size: 10px; padding: 4px 12px; border-radius: 12px; white-space: nowrap; }
  .office-topbar .time { font-size: 11px; color: var(--muted); white-space: nowrap; }

  .office {
    flex: 1; position: relative; overflow: hidden;
    background: linear-gradient(170deg, #2a2540 0%, #1e1b30 40%, #231f35 100%);
    background-image:
      linear-gradient(rgba(255,255,255,0.015) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255,255,255,0.015) 1px, transparent 1px);
    background-size: 40px 40px;
  }
  .office::before {
    content: ''; position: absolute; top: -50px; left: 50%; transform: translateX(-50%);
    width: 500px; height: 300px; border-radius: 50%;
    background: radial-gradient(ellipse, rgba(251,191,36,0.08) 0%, transparent 70%);
    pointer-events: none; z-index: 0;
  }

  /* Wall */
  .wall {
    position: absolute; top: 0; left: 0; right: 0; height: 110px;
    background: linear-gradient(180deg, #4a3f6b 0%, #3d3355 40%, var(--floor) 100%);
    border-bottom: 3px solid rgba(251,191,36,0.1); z-index: 1;
  }
  .wall::after {
    content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 6px;
    background: linear-gradient(90deg, var(--wood-dark), var(--wood), var(--wood-dark));
  }
  .wall-art {
    position: absolute; padding: 8px 16px; border-radius: 4px;
    background: rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.1);
    font-size: 10px; color: var(--muted); box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  }
  .wall-art.poster1 { top: 15px; left: 60px; border-color: rgba(34,197,94,0.3); }
  .wall-art.poster2 { top: 20px; left: 280px; border-color: rgba(251,191,36,0.3); }
  .wall-art.poster3 { top: 15px; right: 400px; border-color: rgba(239,68,68,0.3); }

  .whiteboard {
    position: absolute; z-index: 2; background: #e8e4df; border-radius: 4px;
    border: 3px solid #999; box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    padding: 8px; font-size: 8px; color: #333; line-height: 1.4;
  }
  .whiteboard::before { content: 'üìå'; position: absolute; top: -6px; left: 50%; transform: translateX(-50%); font-size: 12px; }

  .sticky { position: absolute; width: 36px; height: 36px; font-size: 7px; padding: 4px;
    border-radius: 1px; box-shadow: 1px 2px 4px rgba(0,0,0,0.3); z-index: 2;
    font-family: 'Press Start 2P', monospace; line-height: 1.2; transform: rotate(-2deg); color: #333;
  }
  .sticky.yellow { background: #fef08a; }
  .sticky.pink { background: #fda4af; }
  .sticky.blue { background: #93c5fd; }

  .bookshelf { position: absolute; z-index: 2; display: flex; flex-direction: column; gap: 2px; }
  .shelf-row {
    display: flex; gap: 2px; align-items: flex-end;
    background: var(--wood); padding: 2px 4px 0; border-radius: 2px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
  }
  .book { width: 6px; border-radius: 1px; }

  .plant { position: absolute; z-index: 2; text-align: center; }

  .couch {
    position: absolute; z-index: 2; background: #6b4c8a; border-radius: 8px 8px 4px 4px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3); border: 2px solid #5a3d7a;
  }
  .couch::before {
    content: ''; position: absolute; top: 4px; left: 4px; right: 4px; bottom: 4px;
    background: #7c5c9a; border-radius: 6px;
  }
  .couch-label {
    position: absolute; bottom: -14px; left: 50%; transform: translateX(-50%);
    font-family: 'Press Start 2P', monospace; font-size: 6px; color: var(--muted); white-space: nowrap;
  }

  .sleeping-cat { position: absolute; z-index: 3; font-size: 16px; animation: catSleep 3s ease-in-out infinite; }
  @keyframes catSleep { 0%,100% { transform: scale(1); } 50% { transform: scale(1.05); } }
  .zzz { position: absolute; font-size: 8px; animation: zzzFloat 2s ease-in-out infinite; color: var(--muted); }
  @keyframes zzzFloat { 0%,100% { opacity:0.3; transform: translateY(0); } 50% { opacity:1; transform: translateY(-6px); } }

  .rug {
    position: absolute; border-radius: 50%; z-index: 1;
    background: radial-gradient(ellipse, rgba(168,85,247,0.15), rgba(168,85,247,0.05));
    border: 1px solid rgba(168,85,247,0.1);
  }

  .desk {
    position: absolute; width: 100px; height: 55px;
    background: linear-gradient(135deg, var(--wood-light), var(--wood));
    border: 2px solid var(--wood-dark); border-radius: 3px;
    box-shadow: 0 6px 16px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.1); z-index: 2;
  }
  .desk::after {
    content: ''; position: absolute; top: 4px; left: 12px;
    width: 34px; height: 24px; background: #1a1a2e;
    border: 2px solid #555; border-radius: 3px;
    box-shadow: 0 0 8px rgba(34,197,94,0.2), inset 0 0 12px rgba(34,197,94,0.05);
  }
  .desk::before {
    content: ''; position: absolute; top: 28px; left: 24px;
    width: 10px; height: 6px; background: #555; border-radius: 0 0 2px 2px; z-index: 1;
  }
  .desk-keyboard {
    position: absolute; bottom: 6px; left: 14px; width: 28px; height: 8px;
    background: #444; border-radius: 2px; border: 1px solid #555;
  }
  .desk-mug { position: absolute; top: 8px; right: 10px; font-size: 12px; }
  .desk-chair {
    position: absolute; bottom: -20px; left: 50%; transform: translateX(-50%);
    width: 30px; height: 18px; background: #4a4a5a; border-radius: 12px 12px 4px 4px;
    border: 1px solid #5a5a6a; box-shadow: 0 3px 6px rgba(0,0,0,0.3);
  }
  .desk-chair::after {
    content: ''; position: absolute; bottom: -4px; left: 50%; transform: translateX(-50%);
    width: 8px; height: 4px; background: #3a3a4a; border-radius: 0 0 2px 2px;
  }
  .desk-label {
    position: absolute; bottom: -34px; left: 50%; transform: translateX(-50%);
    font-size: 7px; color: var(--muted); white-space: nowrap;
    font-family: 'Press Start 2P', monospace; letter-spacing: 0.5px;
  }

  .coffee-area {
    position: absolute; width: 60px; height: 40px;
    display: flex; flex-direction: column; align-items: center; z-index: 2;
  }
  .coffee-icon { font-size: 24px; }
  .coffee-label { font-size: 7px; color: var(--muted); font-family: 'Press Start 2P', monospace; }
  .coffee-steam { font-size: 10px; animation: steam 2s infinite; opacity: 0.5; }
  @keyframes steam { 0%,100%{opacity:0.3;transform:translateY(0)} 50%{opacity:0.7;transform:translateY(-4px)} }

  /* Agent characters */
  .agent-char {
    position: absolute; width: 50px; display: flex; flex-direction: column;
    align-items: center; cursor: pointer; z-index: 10;
    transition: left 2s ease-in-out, top 2s ease-in-out;
  }
  .agent-char:hover { z-index: 20; }
  .agent-char:hover .agent-bubble { opacity: 1; }
  .agent-sprite {
    font-size: 36px; position: relative;
    filter: drop-shadow(0 4px 8px rgba(0,0,0,0.5));
    width: 44px; height: 44px; display: flex; align-items: center; justify-content: center;
    border-radius: 50%; background: rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.15);
  }
  .agent-nametag {
    font-family: 'Press Start 2P', monospace; font-size: 6px;
    margin-top: 2px; white-space: nowrap;
  }
  .agent-status-dot {
    width: 6px; height: 6px; border-radius: 50%; position: absolute;
    top: 0; right: 0; border: 1px solid var(--floor);
  }
  .agent-status-dot.online { background: var(--green); box-shadow: 0 0 6px var(--green); }
  .agent-status-dot.idle { background: var(--accent); }
  .agent-status-dot.busy { background: var(--red); box-shadow: 0 0 6px var(--red); }

  .agent-bubble {
    position: absolute; bottom: 60px; left: 50%; transform: translateX(-50%);
    background: rgba(30,27,46,0.95); border: 1px solid rgba(251,191,36,0.2);
    border-radius: 10px; padding: 6px 12px; font-size: 10px;
    white-space: nowrap; max-width: 200px; overflow: hidden;
    text-overflow: ellipsis; opacity: 0; transition: opacity 0.3s;
    pointer-events: none; color: var(--text);
    box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  }
  .agent-bubble::after {
    content: ''; position: absolute; bottom: -6px; left: 50%;
    transform: translateX(-50%); border-left: 5px solid transparent;
    border-right: 5px solid transparent; border-top: 6px solid rgba(30,27,46,0.95);
  }
  .agent-char.working .agent-bubble,
  .agent-char.chatting .agent-bubble { opacity: 0.9; }

  .agent-char.working .agent-sprite { animation: typing 0.8s ease-in-out infinite; }
  @keyframes typing {
    0%, 100% { transform: translateY(0) rotate(0); }
    25% { transform: translateY(-2px) rotate(-2deg); }
    75% { transform: translateY(-1px) rotate(1deg); }
  }
  @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.15); } }

  /* Right panel */
  .right-panel {
    width: 380px; background: var(--surface); border-left: 1px solid var(--border);
    display: flex; flex-direction: column;
  }
  .panel-tabs { display: flex; border-bottom: 1px solid var(--border); }
  .panel-tab {
    flex: 1; padding: 10px; text-align: center; font-size: 11px;
    font-weight: 600; cursor: pointer; color: var(--muted);
    border-bottom: 2px solid transparent; transition: all 0.2s;
  }
  .panel-tab.active { color: var(--accent); border-bottom-color: var(--accent); }
  .panel-tab:hover { color: var(--text); }

  .feed { flex: 1; overflow-y: auto; padding: 12px; }
  .feed-item {
    padding: 10px; margin-bottom: 8px; background: rgba(255,255,255,0.03);
    border: 1px solid var(--border); border-radius: 8px;
    font-size: 12px; line-height: 1.5; transition: all 0.15s;
  }
  .feed-item:hover { border-color: var(--accent); background: rgba(255,255,255,0.05); }
  .feed-item .feed-header { display: flex; align-items: center; gap: 8px; margin-bottom: 4px; }
  .feed-item .feed-emoji { font-size: 16px; }
  .feed-item .feed-name { font-weight: 600; font-size: 11px; }
  .feed-item .feed-time { margin-left: auto; font-size: 9px; color: var(--muted); }
  .feed-item .feed-text { color: var(--muted); font-size: 11px; }
  .feed-item .feed-text strong { color: var(--text); }

  .chat-panel { display: none; flex-direction: column; height: 100%; }
  .chat-panel.active { display: flex; }
  .feed-panel { display: none; flex-direction: column; height: 100%; }
  .feed-panel.active { display: flex; flex: 1; overflow: hidden; }

  .chat-header {
    padding: 12px 16px; border-bottom: 1px solid var(--border);
    display: flex; align-items: center; gap: 10px;
  }
  .chat-header .chat-back { background: none; border: none; color: var(--muted); cursor: pointer; font-size: 16px; }
  .chat-header .chat-agent-name { font-weight: 700; font-size: 14px; }
  .chat-header .chat-agent-status { font-size: 10px; color: var(--green); }

  .chat-messages { flex: 1; overflow-y: auto; padding: 12px; }
  .chat-msg {
    margin-bottom: 12px; padding: 10px; border-radius: 8px;
    font-size: 12px; line-height: 1.6; max-width: 90%;
  }
  .chat-msg.agent { background: rgba(255,255,255,0.05); border: 1px solid var(--border); margin-right: auto; }
  .chat-msg.user { background: var(--accent); color: #000; margin-left: auto; border-radius: 8px 8px 2px 8px; }
  .chat-msg .msg-sender { font-size: 10px; font-weight: 700; margin-bottom: 4px; color: var(--muted); }
  .chat-msg.user .msg-sender { color: rgba(0,0,0,0.5); }

  .chat-input-area { padding: 12px; border-top: 1px solid var(--border); }
  .chat-input-wrap {
    display: flex; gap: 8px; background: rgba(255,255,255,0.05);
    border: 1px solid var(--border); border-radius: 8px; padding: 8px 12px;
  }
  .chat-input-wrap input { flex: 1; background: none; border: none; color: var(--text); font-size: 12px; outline: none; }
  .chat-input-wrap button {
    background: var(--accent); color: #000; border: none;
    width: 28px; height: 28px; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 700;
  }

  .hire-more {
    margin: 12px; padding: 12px; background: linear-gradient(135deg, #1a1a2e, #16213e);
    border: 1px dashed var(--accent); border-radius: 8px; text-align: center;
    cursor: pointer; transition: all 0.2s;
  }
  .hire-more:hover { border-style: solid; background: linear-gradient(135deg, #1a1a3e, #162150); }
  .hire-more .hire-text { font-size: 12px; font-weight: 600; }
  .hire-more .hire-sub { font-size: 10px; color: var(--muted); margin-top: 4px; }

  /* Nav bar */
  .site-nav {
    padding: 10px 20px; background: var(--surface); border-bottom: 1px solid var(--border);
    display: flex; align-items: center; justify-content: space-between;
  }
  .site-nav .nav-logo { display: flex; align-items: center; gap: 8px; text-decoration: none; }
  .site-nav .nav-logo span { font-size: 20px; }
  .site-nav .nav-logo strong { font-family: 'Press Start 2P', monospace; font-size: 10px; color: var(--accent); }
  .site-nav .nav-links { display: flex; gap: 16px; align-items: center; }
  .site-nav .nav-links a {
    color: var(--muted); font-size: 12px; font-weight: 500; text-decoration: none;
    padding: 6px 12px; border-radius: 6px; transition: all 0.2s;
  }
  .site-nav .nav-links a:hover { color: var(--text); background: rgba(255,255,255,0.05); }
  .site-nav .nav-links a.active { color: var(--accent); background: rgba(251,191,36,0.1); }

  .empty-state {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    padding: 40px 20px; text-align: center; color: var(--muted); flex: 1;
  }
  .empty-state .empty-icon { font-size: 32px; margin-bottom: 12px; opacity: 0.5; }
  .empty-state .empty-text { font-size: 12px; line-height: 1.6; }

  /* Mobile responsive */
  @media (max-width: 768px) {
    .main-content { flex-direction: column; overflow: auto; }
    .office-wrap { flex: none; height: auto; }
    .office { height: 250px; flex: none; overflow-x: auto; overflow-y: hidden; -webkit-overflow-scrolling: touch; }
    .office-topbar { padding: 8px 12px; flex-wrap: wrap; }
    .office-topbar h1 { font-size: 9px; }
    .right-panel { width: 100%; border-left: none; border-top: 1px solid var(--border); flex: 1; min-height: 50vh; }
    .panel-tab { padding: 12px 8px; font-size: 12px; min-height: 44px; }
    .chat-input-wrap { padding: 10px 14px; }
    .chat-input-wrap input { font-size: 16px; }
    .agent-sprite { font-size: 24px; width: 36px; height: 36px; }
    .agent-nametag { font-size: 5px; }
    .agent-char { width: 40px; }
    .agent-bubble { font-size: 8px; bottom: 40px; max-width: 120px; padding: 4px 6px; }
    .desk { width: 70px; height: 38px; }
    .desk::after { width: 22px; height: 14px; top: 4px; left: 8px; }
    .desk::before { top: 18px; left: 16px; width: 8px; height: 4px; }
    .desk-label { font-size: 5px; bottom: -28px; }
    .desk-keyboard { width: 20px; height: 5px; bottom: 4px; left: 10px; }
    .desk-mug { font-size: 8px; top: 4px; right: 6px; }
    .desk-chair { width: 22px; height: 14px; bottom: -16px; }
    .whiteboard, .bookshelf, .sticky, .couch, .sleeping-cat, .rug,
    .plant:nth-child(n+3) { display: none; }
    .wall { height: 60px; }
    .wall-art { font-size: 8px; padding: 4px 8px; }
    .wall-art.poster1 { left: 20px; top: 10px; }
    .wall-art.poster2 { left: 160px; top: 12px; }
    .wall-art.poster3 { right: 140px; top: 10px; }
    .coffee-icon { font-size: 18px; }
    .coffee-label { font-size: 5px; }
    .feed-item { font-size: 11px; padding: 8px; }
    .chat-msg { font-size: 13px; max-width: 95%; }
    .site-nav .nav-links a { font-size: 11px; padding: 6px 8px; }
  }
</style>
</head>
<body>

<!-- Nav -->
<div class="site-nav">
  <a href="index.html" class="nav-logo"><span>ü¶û</span><strong>AGENT ARENA</strong></a>
  <div class="nav-links">
    <a href="index.html">Home</a>
    <a href="agents.html">Agents</a>
    <a href="hq.html" class="active">HQ</a>
  </div>
</div>

<div class="main-content">
<!-- Office View -->
<div class="office-wrap">
  <div class="office-topbar">
    <h1>ü¶û AGENT ARENA HQ</h1>
    <span class="squad-count" id="squadCount">Loading...</span>
    <span class="gw-status" id="gwStatusBadge" style="color:#8e8ea0;background:rgba(255,255,255,0.05);">‚è≥ Connecting...</span>
    <span class="time" id="clock"></span>
  </div>
  <div class="office" id="office">
    <!-- Wall -->
    <div class="wall">
      <div class="wall-art poster1">ü¶û SHIP IT</div>
      <div class="wall-art poster2">üìà GROW OR DIE</div>
      <div class="wall-art poster3">üîí TRUST NO PORT</div>

      <div class="whiteboard" style="top:8px; right:120px; width:100px; height:55px;">
        <div style="color:#c0392b;font-weight:bold;">Q1 Goals</div>
        <div>‚òë Ship v2</div>
        <div>‚òê 1k users</div>
        <div style="color:#2980b9;">‚òê Series A??</div>
      </div>

      <div class="sticky yellow" style="top:25px; left:200px; transform:rotate(3deg);">FIX<br>BUG</div>
      <div class="sticky pink" style="top:40px; left:420px; transform:rotate(-4deg);">DEMO<br>FRI</div>
      <div class="sticky blue" style="top:12px; left:480px; transform:rotate(1deg);">CALL<br>MOM</div>

      <div class="bookshelf" style="top: 18px; right: 260px;">
        <div class="shelf-row">
          <div class="book" style="height:22px;background:#e74c3c;"></div>
          <div class="book" style="height:18px;background:#3498db;"></div>
          <div class="book" style="height:24px;background:#2ecc71;"></div>
          <div class="book" style="height:20px;background:#f39c12;"></div>
          <div class="book" style="height:16px;background:#9b59b6;"></div>
          <div class="book" style="height:22px;background:#1abc9c;"></div>
          <div class="book" style="height:19px;background:#e67e22;"></div>
        </div>
        <div class="shelf-row">
          <div class="book" style="height:20px;background:#e84393;"></div>
          <div class="book" style="height:24px;background:#0984e3;"></div>
          <div class="book" style="height:17px;background:#6c5ce7;"></div>
          <div class="book" style="height:22px;background:#00b894;"></div>
          <div class="book" style="height:19px;background:#fdcb6e;"></div>
        </div>
      </div>
    </div>

    <!-- Rug -->
    <div class="rug" style="left:290px; top:340px; width:200px; height:140px;"></div>

    <!-- Desks ‚Äî dynamically labeled -->
    <div class="desk" id="desk-0" style="left: 80px; top: 180px;">
      <div class="desk-keyboard"></div>
      <div class="desk-mug">üçµ</div>
      <div class="desk-chair"></div>
      <div class="desk-label" id="desk-label-0">‚Äî</div>
    </div>
    <div class="desk" id="desk-1" style="left: 280px; top: 180px;">
      <div class="desk-keyboard"></div>
      <div class="desk-mug">üßÉ</div>
      <div class="desk-chair"></div>
      <div class="desk-label" id="desk-label-1">‚Äî</div>
    </div>
    <div class="desk" id="desk-2" style="left: 480px; top: 180px;">
      <div class="desk-keyboard"></div>
      <div class="desk-mug">‚òï</div>
      <div class="desk-chair"></div>
      <div class="desk-label" id="desk-label-2">‚Äî</div>
    </div>

    <!-- Plants -->
    <div class="plant" style="left: 20px; top: 160px;"><div style="font-size:24px;">ü™¥</div></div>
    <div class="plant" style="left: 650px; top: 120px;"><div style="font-size:20px;">üåø</div></div>
    <div class="plant" style="right: 40px; top: 300px; opacity: 0.6;">
      <div style="font-size:18px; filter: hue-rotate(40deg) saturate(0.5);">ü™¥</div>
      <div style="font-size:6px; color:var(--muted); font-family:'Press Start 2P',monospace;">RIP</div>
    </div>

    <!-- Couch -->
    <div class="couch" style="left: 560px; top: 340px; width: 100px; height: 45px;">
      <div class="couch-label">üõãÔ∏è LOUNGE</div>
    </div>
    <div class="sleeping-cat" style="left: 590px; top: 330px;">üê±
      <div class="zzz" style="top: -8px; right: -8px;">üí§</div>
    </div>

    <!-- Pizza -->
    <div style="position:absolute; left:620px; top:390px; font-size:16px; z-index:2; transform:rotate(12deg);" title="Last night's pizza">üçï</div>
    <div style="position:absolute; left:615px; top:392px; width:22px; height:22px; background:#c8a06e; border:1px solid #a08050; border-radius:2px; z-index:1; transform:rotate(12deg);"></div>

    <!-- Coffee -->
    <div class="coffee-area" style="left: 600px; top: 130px;">
      <span class="coffee-steam">‚ô®Ô∏è</span>
      <span class="coffee-icon">‚òï</span>
      <span class="coffee-label">COFFEE</span>
    </div>

    <!-- Agent characters container ‚Äî populated dynamically -->
    <div id="agentCharsContainer"></div>
  </div>
</div>

<!-- Right Panel -->
<div class="right-panel">
  <div class="panel-tabs">
    <div class="panel-tab active" onclick="showPanel('feed')">üì° Activity</div>
    <div class="panel-tab" onclick="showPanel('team')">üë• Team</div>
    <div class="panel-tab" onclick="showPanel('chat')">üí¨ DM</div>
  </div>

  <!-- Feed -->
  <div class="feed-panel active" id="feedPanel">
    <div class="feed" id="feedList">
      <div class="empty-state">
        <div class="empty-icon">üì°</div>
        <div class="empty-text">Waiting for agent activity...<br>Events will appear here in real time.</div>
      </div>
    </div>
    <div class="hire-more" onclick="window.location.href='/'">
      <div class="hire-text">‚ûï Hire More Agents</div>
      <div class="hire-sub">Browse the Arena marketplace</div>
    </div>
  </div>

  <!-- Team Chat -->
  <div class="chat-panel" id="teamPanel">
    <div class="chat-header">
      <span style="font-size:16px;">üë•</span>
      <span class="chat-agent-name" style="color: var(--accent);">Team Chat</span>
      <span class="chat-agent-status" id="teamOnlineCount">0 online</span>
    </div>
    <div class="chat-messages" id="teamMessages">
      <div class="empty-state">
        <div class="empty-icon">üí¨</div>
        <div class="empty-text">No team messages yet.<br>Send a message to get started.</div>
      </div>
    </div>
    <div class="chat-input-area">
      <div class="chat-input-wrap">
        <input type="text" placeholder="Message the whole team..." id="teamInput" onkeydown="if(event.key==='Enter')sendTeamMessage()">
        <button onclick="sendTeamMessage()">‚Üë</button>
      </div>
    </div>
  </div>

  <!-- Chat -->
  <div class="chat-panel" id="chatPanel">
    <div class="chat-header">
      <button class="chat-back" onclick="showPanel('feed')">‚Üê back</button>
      <span class="chat-agent-name" id="chatAgentName">Agent</span>
      <span class="chat-agent-status" id="chatAgentStatus">‚óè Checking...</span>
    </div>
    <div class="chat-messages" id="chatMessages"></div>
    <div class="chat-input-area">
      <div class="chat-input-wrap">
        <input type="text" placeholder="Message your agent..." id="chatInput" onkeydown="if(event.key==='Enter')sendMessage()">
        <button onclick="sendMessage()">‚Üë</button>
      </div>
    </div>
  </div>
</div>
</div><!-- /main-content -->

<script>
// ============================================================
// Agent Arena HQ ‚Äî REAL MODE (no demo/canned data)
// ============================================================

// Agent registry ‚Äî populated from server/gateway
const registeredAgents = {}; // agentId -> { name, emoji, color, status, sessionKey }
const hatchedAgents = {};
const feedEvents = [];
let currentChat = null;

const AGENT_COLORS = ['#22c55e', '#ec4899', '#ef4444', '#a855f7', '#3b82f6', '#06b6d4'];
const AGENT_EMOJIS = { main: 'ü¶û', creator: 'üé®', devops: 'üõ°Ô∏è', founder: 'üöÄ', default: 'ü§ñ' };
const AGENT_DESK_POS = [
  { left: 90, top: 130 },
  { left: 290, top: 130 },
  { left: 490, top: 130 },
];

function renderMarkdown(text) {
  return text
    .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
    .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
    .replace(/\*(.+?)\*/g, '<em>$1</em>')
    .replace(/`([^`]+)`/g, '<code style="background:#1a1a2e;padding:2px 4px;border-radius:3px;">$1</code>')
    .replace(/\n/g, '<br>');
}

// ============================================================
// Fetch real agents from gateway
// ============================================================

async function loadAgents() {
  try {
    const resp = await fetch('/api/agents/registered');
    if (resp.ok) {
      const data = await resp.json();
      data.forEach((a, i) => {
        registeredAgents[a.id] = {
          id: a.id,
          name: a.name || a.id,
          emoji: AGENT_EMOJIS[a.id] || AGENT_EMOJIS.default,
          color: AGENT_COLORS[i % AGENT_COLORS.length],
          status: 'idle',
          sessionKey: null,
        };
      });
    }
  } catch (e) {
    console.log('Could not load agents from server, using defaults');
  }

  // Fallback: if no agents loaded, try fetching gateway status
  if (Object.keys(registeredAgents).length === 0) {
    // Hardcode known agents (will be replaced by real data when server responds)
    ['main', 'creator'].forEach((id, i) => {
      registeredAgents[id] = {
        id, name: id === 'main' ? 'Hopper' : 'Creator Agent',
        emoji: AGENT_EMOJIS[id] || 'ü§ñ',
        color: AGENT_COLORS[i],
        status: 'idle', sessionKey: null,
      };
    });
  }

  renderAgents();
  updateSquadCount();
}

function renderAgents() {
  const container = document.getElementById('agentCharsContainer');
  container.innerHTML = '';
  
  Object.values(registeredAgents).forEach((agent, i) => {
    const pos = AGENT_DESK_POS[i] || { left: 90 + i * 200, top: 130 };
    const deskLabel = document.getElementById(`desk-label-${i}`);
    if (deskLabel) deskLabel.textContent = agent.name.toUpperCase();

    const el = document.createElement('div');
    el.className = 'agent-char';
    el.id = `char-${agent.id}`;
    el.style.left = pos.left + 'px';
    el.style.top = pos.top + 'px';
    el.onclick = () => openChat(agent.id);
    el.innerHTML = `
      <div class="agent-bubble" id="bubble-${agent.id}">Idle</div>
      <div class="agent-sprite" style="background:${agent.color}33; border-color:${agent.color}66;">
        ${agent.emoji}
        <div class="agent-status-dot idle"></div>
      </div>
      <div class="agent-nametag" style="color:${agent.color};">${agent.name.toUpperCase()}</div>
    `;
    container.appendChild(el);
  });
}

function updateSquadCount() {
  const count = Object.keys(registeredAgents).length;
  document.getElementById('squadCount').textContent = `Squad: ${count} agent${count !== 1 ? 's' : ''}`;
  document.getElementById('teamOnlineCount').textContent = `${count} registered`;
}

function updateAgentStatus(agentId, status, bubble) {
  const agent = registeredAgents[agentId];
  if (!agent) return;
  agent.status = status;

  const el = document.getElementById(`char-${agentId}`);
  if (!el) return;

  const dot = el.querySelector('.agent-status-dot');
  if (status === 'working') {
    el.className = 'agent-char working';
    dot.className = 'agent-status-dot busy';
  } else if (status === 'online') {
    el.className = 'agent-char';
    dot.className = 'agent-status-dot online';
  } else {
    el.className = 'agent-char';
    dot.className = 'agent-status-dot idle';
  }

  if (bubble) {
    const bubbleEl = document.getElementById(`bubble-${agentId}`);
    if (bubbleEl) bubbleEl.textContent = bubble;
  }
}

// ============================================================
// Activity feed ‚Äî REAL events only
// ============================================================

function addFeedEvent(agentId, html) {
  const agent = registeredAgents[agentId] || { emoji: 'ü§ñ', name: agentId, color: '#8e8ea0' };
  const time = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });

  feedEvents.unshift({ agentId, html, time });
  if (feedEvents.length > 50) feedEvents.pop();

  const el = document.getElementById('feedList');
  // Clear empty state
  const empty = el.querySelector('.empty-state');
  if (empty) empty.remove();

  const item = document.createElement('div');
  item.className = 'feed-item';
  item.onclick = () => openChat(agentId);
  item.innerHTML = `
    <div class="feed-header">
      <span class="feed-emoji">${agent.emoji}</span>
      <span class="feed-name" style="color:${agent.color}">${agent.name}</span>
      <span class="feed-time">${time}</span>
    </div>
    <div class="feed-text">${html}</div>
  `;
  el.prepend(item);
}

// ============================================================
// Panel navigation
// ============================================================

function showPanel(panel) {
  const tabs = { feed: 0, team: 1, chat: 2 };
  document.querySelectorAll('.panel-tab').forEach((t,i) => t.classList.toggle('active', i === tabs[panel]));
  document.getElementById('feedPanel').classList.toggle('active', panel === 'feed');
  document.getElementById('teamPanel').classList.toggle('active', panel === 'team');
  document.getElementById('chatPanel').classList.toggle('active', panel === 'chat');
}

function openChat(agentId) {
  currentChat = agentId;
  const agent = registeredAgents[agentId];
  if (!agent) return;

  document.getElementById('chatAgentName').textContent = agent.name;
  document.getElementById('chatAgentName').style.color = agent.color;
  document.getElementById('chatAgentStatus').textContent = hatchedAgents[agentId] ? '‚óè Online' : '‚óã Not hatched';
  document.getElementById('chatAgentStatus').style.color = hatchedAgents[agentId] ? '#22c55e' : '#8e8ea0';
  showPanel('chat');

  if (hatchedAgents[agentId]) {
    const inputArea = document.querySelector('#chatPanel .chat-input-area');
    inputArea.style.display = '';
  } else {
    showHatchScreen(agentId);
  }
}

// ============================================================
// WebSocket connection to server (bridges to gateway)
// ============================================================

let ws = null;
let wsConnected = false;

function connectWS() {
  ws = new WebSocket(`ws://${location.host}/`);
  
  ws.onopen = () => {
    console.log('üîå Connected to Arena server');
  };
  
  ws.onmessage = (e) => {
    try { handleWSMessage(JSON.parse(e.data)); }
    catch (err) { console.error('WS parse error:', err); }
  };
  
  ws.onclose = () => {
    wsConnected = false;
    updateGatewayBadge(false);
    setTimeout(connectWS, 3000);
  };
  
  ws.onerror = () => {};
}

function updateGatewayBadge(connected) {
  const badge = document.getElementById('gwStatusBadge');
  if (connected) {
    badge.textContent = '‚óè Connected';
    badge.style.color = '#22c55e';
    badge.style.background = 'rgba(34,197,94,0.1)';
    badge.style.border = '1px solid rgba(34,197,94,0.2)';
  } else {
    badge.textContent = '‚óã Disconnected';
    badge.style.color = '#ef4444';
    badge.style.background = 'rgba(239,68,68,0.1)';
    badge.style.border = '1px solid rgba(239,68,68,0.2)';
  }
}

function handleWSMessage(msg) {
  if (msg.type === 'status') {
    wsConnected = msg.connected;
    updateGatewayBadge(msg.connected);
  }

  if (msg.type === 'hatch-ok') {
    const agentId = msg.agentPkg; // server sends agentPkg
    hatchedAgents[agentId] = { sessionKey: msg.sessionKey, agent: msg.agent };
    updateAgentStatus(agentId, 'working', 'Waking up...');
    addFeedEvent(agentId, '<strong>Hatched!</strong> Agent is now online');
  }

  // Agent events ‚Äî streaming text + tool calls + lifecycle
  if (msg.type === 'agent-event') {
    const agentId = msg.agentPkg;
    const payload = msg.payload;
    const runId = payload.runId;
    const agent = registeredAgents[agentId] || { emoji: 'ü§ñ', name: agentId, color: '#8e8ea0' };

    // Streaming assistant text
    if (payload.stream === 'assistant' && payload.data?.text) {
      updateAgentStatus(agentId, 'working', 'Responding...');
      const msgs = document.getElementById('chatMessages');
      const typingEl = document.querySelector('.typing-indicator');
      if (typingEl) typingEl.remove();

      let streamEl = document.getElementById(`stream-${runId}`);
      if (!streamEl) {
        streamEl = document.createElement('div');
        streamEl.id = `stream-${runId}`;
        streamEl.className = 'chat-msg agent';
        streamEl.style.borderLeft = `3px solid ${agent.color}`;
        streamEl.innerHTML = `<div class="msg-sender">${agent.emoji} ${agent.name}</div><span class="stream-text"></span>`;
        msgs.appendChild(streamEl);
      }
      streamEl.querySelector('.stream-text').innerHTML = renderMarkdown(payload.data.text);
      msgs.scrollTop = msgs.scrollHeight;
    }

    // Tool calls
    if (payload.stream === 'tool' && payload.data) {
      const toolName = payload.data.name || payload.data.tool || 'tool';
      updateAgentStatus(agentId, 'working', `Using ${toolName}...`);
      addFeedEvent(agentId, `Using <strong>${toolName}</strong>`);

      if (currentChat === agentId) {
        const msgs = document.getElementById('chatMessages');
        const toolId = `tool-${runId}-${toolName}-${Date.now()}`;
        if (!document.getElementById(toolId)) {
          const toolEl = document.createElement('div');
          toolEl.id = toolId;
          toolEl.className = 'chat-msg agent';
          toolEl.style.borderLeft = `3px solid ${agent.color}`;
          toolEl.style.opacity = '0.6';
          toolEl.style.fontSize = '11px';
          toolEl.innerHTML = `<div class="msg-sender">üîß ${agent.name}</div>Using <strong>${toolName}</strong>...`;
          msgs.appendChild(toolEl);
          msgs.scrollTop = msgs.scrollHeight;
        }
      }
    }

    // Lifecycle
    if (payload.stream === 'lifecycle') {
      if (payload.data?.phase === 'start') {
        updateAgentStatus(agentId, 'working', 'Thinking...');
      }
      if (payload.data?.phase === 'end') {
        updateAgentStatus(agentId, 'online', 'Ready');
        const inputArea = document.querySelector('#chatPanel .chat-input-area');
        if (inputArea) inputArea.style.display = '';

        // Add final text to feed
        const streamEl = document.getElementById(`stream-${runId}`);
        if (streamEl) {
          const text = streamEl.querySelector('.stream-text')?.textContent || '';
          if (text) addFeedEvent(agentId, `<strong>Responded:</strong> ${text.slice(0, 100)}${text.length > 100 ? '...' : ''}`);
        }
      }
    }
  }

  // Chat final
  if (msg.type === 'chat-final') {
    const agentId = msg.agentPkg;
    const agent = registeredAgents[agentId] || { emoji: 'ü§ñ', name: agentId, color: '#8e8ea0' };
    const msgs = document.getElementById('chatMessages');
    const typingEl = document.querySelector('.typing-indicator');
    if (typingEl) typingEl.remove();

    let finalText = '';
    if (typeof msg.message === 'string') finalText = msg.message;
    else if (msg.message?.role === 'assistant' && Array.isArray(msg.message.content)) {
      for (const part of msg.message.content) {
        if (part.type === 'text' && part.text) finalText += part.text;
      }
    }

    let streamEl = document.getElementById(`stream-${msg.runId}`);
    if (streamEl && finalText) {
      streamEl.querySelector('.stream-text').innerHTML = renderMarkdown(finalText);
    } else if (finalText && currentChat === agentId) {
      const el = document.createElement('div');
      el.className = 'chat-msg agent';
      el.style.borderLeft = `3px solid ${agent.color}`;
      el.innerHTML = `<div class="msg-sender">${agent.emoji} ${agent.name}</div><span class="stream-text">${renderMarkdown(finalText)}</span>`;
      msgs.appendChild(el);
    }
    msgs.scrollTop = msgs.scrollHeight;
    updateAgentStatus(agentId, 'online', 'Ready');
  }

  if (msg.type === 'error') {
    console.error('Server error:', msg.error);
    const msgs = document.getElementById('chatMessages');
    if (msgs) {
      const typingEl = document.querySelector('.typing-indicator');
      if (typingEl) typingEl.remove();
      msgs.innerHTML += `<div class="chat-msg agent"><div class="msg-sender">‚ö†Ô∏è System</div>${msg.error}</div>`;
      msgs.scrollTop = msgs.scrollHeight;
    }
  }
}

// ============================================================
// Hatch & Chat
// ============================================================

function showHatchScreen(agentId) {
  const agent = registeredAgents[agentId];
  if (!agent) return;
  const msgs = document.getElementById('chatMessages');
  const inputArea = document.querySelector('#chatPanel .chat-input-area');
  inputArea.style.display = 'none';

  msgs.innerHTML = `
    <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;text-align:center;padding:24px;">
      <div style="font-size:64px;margin-bottom:16px;animation:pulse 2s infinite;">ü•ö</div>
      <div style="font-family:'Press Start 2P',monospace;font-size:12px;color:${agent.color};margin-bottom:8px;">${agent.name}</div>
      <div style="font-size:13px;color:#8e8ea0;margin-bottom:24px;max-width:300px;line-height:1.6;">
        This is a <strong>real OpenClaw agent</strong> with its own workspace, memory, and full tool access. Hatching starts a persistent session.
      </div>
      <button onclick="hatchAgent('${agentId}')" id="hatchBtn" style="padding:14px 32px;background:linear-gradient(135deg,${agent.color},${agent.color}cc);color:#000;border:none;border-radius:12px;font-weight:700;font-size:15px;cursor:pointer;font-family:'Press Start 2P',monospace;transition:all 0.3s;box-shadow:0 0 20px ${agent.color}44;">
        üê£ HATCH AGENT
      </button>
      <div style="font-size:10px;color:#6e6e80;margin-top:12px;">Real sub-agent ¬∑ Own workspace ¬∑ Full tool access</div>
    </div>
  `;
}

function hatchAgent(agentId) {
  const agent = registeredAgents[agentId];
  if (!agent) return;
  const msgs = document.getElementById('chatMessages');
  const btn = document.getElementById('hatchBtn');
  btn.disabled = true;
  btn.innerHTML = 'ü•ö HATCHING...';
  btn.style.opacity = '0.7';

  msgs.innerHTML = `
    <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;text-align:center;padding:24px;">
      <div style="font-size:64px;margin-bottom:16px;" id="hatchEgg">ü•ö</div>
      <div style="font-family:'Press Start 2P',monospace;font-size:11px;color:${agent.color};" id="hatchStatus">Connecting to gateway...</div>
    </div>
  `;

  const egg = document.getElementById('hatchEgg');
  const status = document.getElementById('hatchStatus');
  setTimeout(() => { egg.textContent = 'üê£'; status.textContent = 'Spawning sub-agent...'; }, 1000);
  setTimeout(() => { status.textContent = 'Agent waking up...'; }, 2500);

  if (ws && ws.readyState === WebSocket.OPEN) {
    ws.send(JSON.stringify({ type: 'hatch', agentPkg: agentId }));
    
    setTimeout(() => {
      egg.textContent = 'üê•';
      status.textContent = `${agent.name} is alive!`;
      setTimeout(() => {
        const inputArea = document.querySelector('#chatPanel .chat-input-area');
        inputArea.style.display = '';
        msgs.innerHTML = `
          <div style="text-align:center;padding:12px;margin-bottom:8px;">
            <span style="font-size:10px;color:#6e6e80;background:#1a1a2e;padding:4px 12px;border-radius:12px;">üê£ ${agent.name} hatched ¬∑ real sub-agent</span>
          </div>
          <div class="chat-msg agent typing-indicator" style="border-left: 3px solid ${agent.color};">
            <div class="msg-sender">${agent.emoji} ${agent.name}</div>
            <em style="color:#8e8ea0;">waking up...</em>
          </div>
        `;
        msgs.scrollTop = msgs.scrollHeight;
      }, 1200);
    }, 3000);
  } else {
    msgs.innerHTML = `<div style="text-align:center;padding:24px;color:#ef4444;">‚ùå Not connected to server.<br><br><button onclick="showHatchScreen('${agentId}')" style="padding:8px 16px;background:#1a1a2e;border:1px solid #2a2a3a;color:#ececf1;border-radius:8px;cursor:pointer;">Try Again</button></div>`;
  }
}

function sendMessage() {
  if (!currentChat) return;
  const input = document.getElementById('chatInput');
  const text = input.value.trim();
  if (!text) return;
  input.value = '';
  const agent = registeredAgents[currentChat];
  if (!agent) return;
  const msgs = document.getElementById('chatMessages');

  msgs.innerHTML += `<div class="chat-msg user"><div class="msg-sender">üë§ You</div>${text}</div>`;
  msgs.innerHTML += `<div class="chat-msg agent typing-indicator" style="border-left: 3px solid ${agent.color};"><div class="msg-sender">${agent.emoji} ${agent.name}</div><em style="color:#8e8ea0;">thinking...</em></div>`;
  msgs.scrollTop = msgs.scrollHeight;

  if (ws && ws.readyState === WebSocket.OPEN) {
    ws.send(JSON.stringify({ type: 'chat', agentPkg: currentChat, message: text }));
  } else {
    document.querySelector('.typing-indicator')?.remove();
    msgs.innerHTML += `<div class="chat-msg agent"><div class="msg-sender">‚ö†Ô∏è System</div>Not connected.</div>`;
  }
}

function sendTeamMessage() {
  const input = document.getElementById('teamInput');
  const text = input.value.trim();
  if (!text) return;
  input.value = '';
  const msgs = document.getElementById('teamMessages');
  const empty = msgs.querySelector('.empty-state');
  if (empty) empty.remove();

  msgs.innerHTML += `<div class="chat-msg user"><div class="msg-sender">üë§ You</div>${text}</div>`;
  msgs.scrollTop = msgs.scrollHeight;

  // Send to first available hatched agent
  const firstHatched = Object.keys(hatchedAgents)[0];
  if (ws && ws.readyState === WebSocket.OPEN && firstHatched) {
    ws.send(JSON.stringify({ type: 'chat', agentPkg: firstHatched, message: `[Team Chat] ${text}` }));
  }
}

// ============================================================
// Clock
// ============================================================

function updateClock() {
  document.getElementById('clock').textContent = new Date().toLocaleTimeString('en-US', {
    hour: '2-digit', minute: '2-digit', timeZoneName: 'short'
  });
}

// ============================================================
// Init
// ============================================================

updateClock();
setInterval(updateClock, 1000);
connectWS();
loadAgents();
</script>
</body>
</html>
